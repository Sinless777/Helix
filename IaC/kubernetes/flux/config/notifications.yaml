---
apiVersion: notification.toolkit.fluxcd.io/v1beta3
kind: Provider
metadata:
  name: discord-notifier
  namespace: flux-system
  labels:
    app.kubernetes.io/name: discord-notifier
    app.kubernetes.io/part-of: helix-platform
    app.kubernetes.io/managed-by: fluxcd
    helix.ai/component: notification-provider
spec:
  type: discord
  secretRef:
    name: discord-webhook-url
---
apiVersion: notification.toolkit.fluxcd.io/v1beta3
kind: Alert
metadata:
  name: flux-on-call
  namespace: flux-system
  labels:
    app.kubernetes.io/name: flux-on-call-alert
    app.kubernetes.io/part-of: helix-platform
    app.kubernetes.io/managed-by: fluxcd
    helix.ai/component: notification-alert
spec:
  providerRef:
    name: discord-notifier
  eventSeverity: error
  eventSources:
    - kind: GitRepository
      namespace: flux-system
      name: "*"
    - kind: Kustomization
      namespace: flux-system
      name: "*"
    - kind: HelmRelease
      namespace: flux-system
      name: "*"
  eventMetadata:
    cluster: ${CLUSTER_NAME}
    env: ${ENVIRONMENT}        # e.g. production / staging
    source: flux-system
