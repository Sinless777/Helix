---
apiVersion: audit.k8s.io/v1
kind: Policy
metadata:
  name: helix-platform-audit-policy
  labels:
    app.kubernetes.io/part-of: helix-platform
    app.kubernetes.io/managed-by: fluxcd
    helix.ai/component: audit-policy

# Omit early stages to reduce noise
omitStages:
  - "RequestReceived"

rules:
  # 1. Admin-level operations: full details for RBAC & control-plane
  - level: RequestResponse
    resources:
      - group: authorization.k8s.io
        resources: ["roles","rolebindings","clusterroles","clusterrolebindings"]
      - group: ""
        resources: ["secrets"]
    verbs:
      - create
      - update
      - patch
      - delete

  # 2. Platform workload operations: metadata only for workloads
  - level: Metadata
    resources:
      - group: ""
        resources: ["pods","deployments","replicasets","jobs","cronjobs"]
      - group: apps
        resources: ["statefulsets","daemonsets"]
    verbs:
      - create
      - update
      - patch
      - delete

  # 3. Namespace & ConfigMap changes: higher detail
  - level: Request
    resources:
      - group: ""
        resources: ["namespaces","configmaps"]
    verbs:
      - create
      - update
      - patch
      - delete

  # 4. Catch-all: metadata for all other requests
  - level: Metadata
    # no specific resource group â†’ matches all
