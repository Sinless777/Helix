apiVersion: v1
kind: ConfigMap
metadata:
  name: helix-platform-audit-policy
  namespace: flux-system
  labels:
    app.kubernetes.io/part-of: helix-platform
    app.kubernetes.io/managed-by: fluxcd
    helix.ai/component: audit-policy
data:
  policy.yaml: |
    apiVersion: audit.k8s.io/v1
    kind: Policy
    metadata:
      name: helix-platform-audit-policy

    omitStages:
      - "RequestReceived"

    rules:
      - level: RequestResponse
        resources:
          - group: authorization.k8s.io
            resources:
              - roles
              - rolebindings
              - clusterroles
              - clusterrolebindings
          - group: ""
            resources:
              - secrets
        verbs:
          - create
          - update
          - patch
          - delete

      - level: Metadata
        resources:
          - group: ""
            resources:
              - pods
              - deployments
              - replicasets
              - jobs
              - cronjobs
          - group: apps
            resources:
              - statefulsets
              - daemonsets
        verbs:
          - create
          - update
          - patch
          - delete

      - level: Request
        resources:
          - group: ""
            resources:
              - namespaces
              - configmaps
        verbs:
          - create
          - update
          - patch
          - delete

      - level: Metadata
