# IaC/.sops.yaml
# This SOPS config covers:
# - ansible/*
# - kubernetes/*
# - terraform/*
#
# Any user who wants to decrypt must:
#   1. Have one of the PGP private keys listed below
#   2. Have that key imported into their local GPG keyring

creation_rules:
  # ---------------------------------------------------------------------------
  # Ansible: group_vars / host_vars / vault files
  # ---------------------------------------------------------------------------
  - path_regex: ^ansible/(group_vars|host_vars|vault)/.*\.(yml|yaml)$
    key_groups:
      - pgp:
          # Timothy "Andy" Andrew Pierce - Helix / SinLess
          - A25EFEA975F16297E0765B25AF60954F70D230D4
          - DF0A8D61F4818A36E0409C2B295E99E6DD33049E
          # Add other Ansible users here:
          # - OTHER_USER_FINGERPRINT
    # Encrypt typical secret-looking fields
    encrypted_regex: '^(data|stringData|password|pass|secret|token|api_key|client_secret|access_key)$'

  # ---------------------------------------------------------------------------
  # Kubernetes: Secret manifests / values files (dev, staging, prod, etc.)
  # ---------------------------------------------------------------------------
  - path_regex: ^kubernetes/.*/.*(secret|secrets|values).*\.ya?ml$
    key_groups:
      - pgp:
          - A25EFEA975F16297E0765B25AF60954F70D230D4
          - DF0A8D61F4818A36E0409C2B295E99E6DD33049E
          # Add cluster operators / platform team here:
          # - OTHER_K8S_OPERATOR_FP
    # Standard pattern: encrypt Secret data, leave apiVersion/kind/metadata in clear
    encrypted_regex: '^(data|stringData)$'

  # Example: stricter rules for prod-only secrets (optional, adjust paths to match your repo)
  # - path_regex: ^kubernetes/prod/.*/.*(secret|secrets|values).*\.ya?ml$
  #   key_groups:
  #     - pgp:
  #         - DF0A8D61F4818A36E0409C2B295E99E6DD33049E   # e.g. "prod-only" key
  #         # - ANOTHER_PROD_ONLY_FP
  #   encrypted_regex: '^(data|stringData)$'

  # ---------------------------------------------------------------------------
  # Terraform: tfvars / tfvars.json with sensitive values
  # ---------------------------------------------------------------------------
  - path_regex: ^terraform/.*\.tfvars(\.json)?$
    key_groups:
      - pgp:
          - A25EFEA975F16297E0765B25AF60954F70D230D4
          - DF0A8D61F4818A36E0409C2B295E99E6DD33049E
          # Add infra / platform engineers here:
          # - OTHER_TERRAFORM_USER_FP
    # For tfvars, it's usually simpler to encrypt the entire file
    encrypted_regex: '.*'

  # ---------------------------------------------------------------------------
  # Generic "secret" files anywhere under IaC
  #   examples:
  #   - something.secret.yaml
  #   - example.enc.yaml
  #   - any .sops.env
  # ---------------------------------------------------------------------------
  - path_regex: ^.*\.(secret|enc)\.(ya?ml|json|env)$
    key_groups:
      - pgp:
          - A25EFEA975F16297E0765B25AF60954F70D230D4
          - DF0A8D61F4818A36E0409C2B295E99E6DD33049E
          # Generic secrets users:
          # - OTHER_USER_FP
    encrypted_regex: '.*'
