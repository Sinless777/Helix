name: "Move Backlog Milestones to Backlog Column"

on:
  workflow_dispatch:
  issues:
    types:
      - opened
      - edited
      - milestoned
      - demilestoned

jobs:
  sync-backlog-status:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: "24"
          cache: "npm"
          cache-dependency-path: ".github/scripts/package.json"

      - name: Install script dependencies
        run: npm install --prefix .github/scripts

      - name: Update project status for backlog milestone
        if: ${{ github.event.issue != null }}
        env:
          GITHUB_TOKEN: ${{ secrets.PROJECTS_PAT }}
          GITHUB_REPOSITORY: ${{ github.repository }}
          GITHUB_REPOSITORY_OWNER: ${{ github.repository_owner }}
          PROJECT_OWNER: ${{ github.repository_owner }}
          PROJECT_NUMBER: "8"
          MILESTONE_NAME: "Backlog"
          STATUS_FIELD_NAME: "Status"
          STATUS_OPTION_NAME: "Backlog"
        run: node .github/scripts/projects/update-status-from-milestone.js
